var app=new Vue({el:"#app",data:{state:"welcome",geolocationSettings:{enableHighAccuracy:!1,maximumAge:0,timeout:2e4},geolocationId:null,map:null,audio:new Audio,audioName:"",currentTime:0,totalTime:0,isPlaying:!1},created:function(){this.audio.addEventListener("timeupdate",this.onAudioUpdate),this.audio.addEventListener("ended",this.onAudioEnded),this.audio.addEventListener("pause",this.onAudioStopped),this.audio.addEventListener("play",this.onAudioStarted);var o=this,t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","https://rawgit.com/hmcro/Maps/master/test-n20sx.geojson",!0),t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&(o.markers=JSON.parse(t.responseText))},t.send(null)},methods:{goto:function(o){this.state=o,"map"!=o||this.map||this.initGeolocation()},link:function(o){location.href=o},initGeolocation:function(){navigator.geolocation.getCurrentPosition(this.onGeolocationSuccess,this.onGeolocationError,this.geolocationSettings)},onGeolocationSuccess:function(o){this.latitude=o.coords.latitude,this.longitude=o.coords.longitude,console.log(this.latitude,this.longitude),this.map||this.initMap()},onGeolocationError:function(o){console.warn("ERROR("+o.code+"): "+o.message)},initMap:function(){console.log("map init"),mapboxgl.accessToken="pk.eyJ1IjoibHVrZXN0dXJnZW9uIiwiYSI6ImNpazcwenlzYjAwenZpZm0yZGVtOXpzNGoifQ.qBHqidaLVWQtIEu09uhSkg",this.map=new mapboxgl.Map({container:"map",style:"mapbox://styles/lukesturgeon/cjlrt20fu8i3z2spjnowdy5ae",center:[this.longitude,this.latitude],zoom:17.1});var o=this;this.map.on("load",function(){o.markers.features.forEach(function(t){var i=document.createElement("div");i.className="marker",new mapboxgl.Marker(i).setLngLat(t.geometry.coordinates).addTo(o.map)});var t=document.createElement("div");t.className="user",new mapboxgl.Marker(t).setLngLat([o.longitude,o.latitude]).addTo(o.map),o.geolocationId=navigator.geolocation.watchPosition(o.onGeolocationSuccess,o.onGeolocationError,o.geolocationSettings)})},playAudio:function(o){this.audioName=o,this.audio.src="/audio/"+o+".mp3",this.audio.play()},toggleAudio:function(){this.isPlaying?this.audio.pause():this.audio.play()},onAudioUpdate:function(){this.currentTime=Math.floor(this.audio.currentTime),this.totalTime=Math.floor(this.audio.duration)},onAudioStarted:function(){this.isPlaying=!0},onAudioStopped:function(){this.isPlaying=!1,console.log("onAudioStopped")}},computed:{progress:function(){return Math.floor(this.currentTime/this.totalTime*100)},jsSupported:function(){return!0},audioSupported:function(){return Modernizr.audio},geolocationSupported:function(){return Modernizr.geolocation}}});