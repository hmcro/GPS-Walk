var app=new Vue({el:"#app",data:{state:"welcome",geolocationSettings:{enableHighAccuracy:!1,maximumAge:0,timeout:2e4},geolocationId:null,map:null,userMarker:null,audio:new Audio,audioName:"",currentTime:0,totalTime:0,isPlaying:!1},created:function(){console.log("hmcro v 3.0r2"),this.audio.addEventListener("timeupdate",this.onAudioUpdate),this.audio.addEventListener("ended",this.onAudioEnded),this.audio.addEventListener("pause",this.onAudioStopped),this.audio.addEventListener("play",this.onAudioStarted);var t=this,o=new XMLHttpRequest;o.overrideMimeType("application/json"),o.open("GET","https://raw.githubusercontent.com/hmcro/Maps/master/test-n20sx.geojson",!0),o.onreadystatechange=function(){4==o.readyState&&"200"==o.status&&(t.markers=JSON.parse(o.responseText))},o.send(null)},methods:{goto:function(t){"map"!=t||this.map||this.initGeolocation(),this.state=t},link:function(t){location.href=t},initGeolocation:function(){navigator.geolocation.getCurrentPosition(this.onGeolocationSuccess,this.onGeolocationError,this.geolocationSettings)},onGeolocationSuccess:function(t){if(this.latitude=t.coords.latitude,this.longitude=t.coords.longitude,console.log(this.longitude,this.latitude),this.map){this.userMarker&&this.userMarker.setLngLat([this.longitude,this.latitude]),this.map.panTo([this.longitude,this.latitude]);var o=this;this.markers.features.forEach(function(t){var e=turf.point([o.longitude,o.latitude]),i=turf.point([t.geometry.coordinates[0],t.geometry.coordinates[1]]);Math.floor(1e3*turf.distance(e,i))<=20&&(o.playAudio(t.properties.mp3),alert("play "+t.properties.mp3))})}else this.initMap()},onGeolocationError:function(t){1==t.code?alert("Location access is denied. Use your phone's settings to enable."):(console.warn("ERROR("+t.code+"): "+t.message),alert(t.message))},initMap:function(){console.log("map init"),console.log(this),mapboxgl.accessToken="pk.eyJ1IjoibHVrZXN0dXJnZW9uIiwiYSI6ImNpazcwenlzYjAwenZpZm0yZGVtOXpzNGoifQ.qBHqidaLVWQtIEu09uhSkg",this.map=new mapboxgl.Map({container:"map",style:"mapbox://styles/lukesturgeon/cjlrt20fu8i3z2spjnowdy5ae",center:[this.longitude,this.latitude],zoom:17.1});var t=this;this.map.on("load",function(){t.markers.features.forEach(function(o){var e=document.createElement("div");e.className="marker",new mapboxgl.Marker(e).setLngLat(o.geometry.coordinates).addTo(t.map)});var o=document.createElement("div");o.className="user",t.userMarker=new mapboxgl.Marker(o).setLngLat([t.longitude,t.latitude]).addTo(t.map),t.geolocationId=navigator.geolocation.watchPosition(t.onGeolocationSuccess,t.onGeolocationError,t.geolocationSettings)})},playAudio:function(t){this.audioName=t,this.audio.src="/audio/"+t+".mp3",this.audio.play()},toggleAudio:function(){this.isPlaying?this.audio.pause():this.audio.play()},onAudioUpdate:function(){this.currentTime=Math.floor(this.audio.currentTime),this.totalTime=Math.floor(this.audio.duration)},onAudioStarted:function(){this.isPlaying=!0},onAudioStopped:function(){this.isPlaying=!1,console.log("onAudioStopped")}},computed:{progress:function(){return Math.floor(this.currentTime/this.totalTime*100)},jsSupported:function(){return!0},audioSupported:function(){return Modernizr.audio},geolocationSupported:function(){return Modernizr.geolocation}}});